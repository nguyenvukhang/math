#!/usr/bin/env python3

from subprocess import Popen, PIPE
from os import path
import os


class PdfLatex(Popen):
    # start a subprocess of `pdflatex` ready to take a latex file in
    # from stdin
    def __init__(self, jobname="minimath", build_dir=".build", dev_mode=False):
        # tells latex compiler to search for .sty packages in this folder.
        os.environ["TEXINPUTS"] = "tex_modules/:"

        self.jobname = jobname
        self.build_dir = build_dir
        self.dev_mode = dev_mode

        j, d = jobname, build_dir

        if not path.isdir(build_dir):
            os.mkdir(build_dir)

        cmd = ("pdflatex", "-halt-on-error", f"-output-directory={d}", f"-jobname={j}")
        super().__init__(cmd, stdin=PIPE, stdout=PIPE, stderr=PIPE, env=os.environ)
